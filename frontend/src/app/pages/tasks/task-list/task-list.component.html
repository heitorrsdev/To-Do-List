<div class="task-list-container">
  <header class="task-header">
    <h2>Minhas Tarefas</h2>
    <button (click)="logout()" class="logout-button">Logout</button>
  </header>

  <div class="add-task-section">
    <h3>Adicionar Nova Tarefa</h3>
    <form [formGroup]="addTaskForm" (ngSubmit)="addTask()" novalidate>
      <div class="form-group">
        <label for="title">Título:</label>
        <input type="text" id="title" formControlName="title" placeholder="O que precisa ser feito?"
          [ngClass]="{ 'is-invalid': addTaskForm.get('title')?.invalid && (addTaskForm.get('title')?.dirty || addTaskForm.get('title')?.touched) }">
        <div
          *ngIf="addTaskForm.get('title')?.invalid && (addTaskForm.get('title')?.dirty || addTaskForm.get('title')?.touched)"
          class="error-message">
          <small *ngIf="addTaskForm.get('title')?.errors?.['required']">Título é obrigatório.</small>
        </div>
      </div>
      <div class="form-group">
        <label for="description">Descrição (Opcional):</label>
        <textarea id="description" formControlName="description" rows="3" placeholder="Adicione mais detalhes...">
        </textarea>
      </div>
      <button type="submit" [disabled]="addTaskForm.invalid || isLoading">Adicionar Tarefa</button>
    </form>
  </div>

  <div class="task-items-section">
    <h3>Lista de Tarefas</h3>

    <div *ngIf="isLoading && tasks.length === 0" class="loading-message">Carregando tarefas...</div>
    <div *ngIf="errorMessage" class="error-message api-error">{{ errorMessage }}</div>

    <ul *ngIf="!isLoading || tasks.length > 0" class="task-list">
      <li *ngIf="!isLoading && tasks.length === 0" class="no-tasks-message">
        Nenhuma tarefa encontrada. Adicione uma nova tarefa acima!
      </li>
      <li *ngFor="let task of tasks" class="task-item" [class.completed]="task.status === 'completed'">
        <div class="task-content">
          <input
            type="checkbox"
            [checked]="task.status === 'completed'"
            (change)="updateTaskStatus(task, $event)"
            class="task-checkbox"
            id="task-{{task._id}}"
          >
          <label for="task-{{task._id}}" class="task-title">{{ task.title }}</label>
          <p *ngIf="task.description" class="task-description">{{ task.description }}</p>
        </div>
        <button (click)="deleteTask(task._id)" class="delete-button" title="Excluir Tarefa">
          &times; <!-- Simple 'x' icon -->
        </button>
      </li>
    </ul>
  </div>

</div>
